define(["./chunks/vendor-22992e2c","./chunks/useAppDefaults-a6c3be91","./chunks/visibility-c7f197c2","./chunks/base-fbc1ccef","./chunks/useSpacesLoading-b404aeae","./chunks/useGraphClient-6c0c047b","./chunks/useDriveResolver-be2aa3cc","./chunks/functions-f74c7f04"],(function(e,t,r,a,i,n,s,o){"use strict";var p={cs:{},de:{'"%{appName}" app content area':'"%{appName}" Anwendungsinhaltsbereich','"%{appName}" app page':'"%{appName}" Anwendungsseite',"Error in app server response":"Fehler in der Antwort des Anwendungsservers","Error retrieving file information":"Datei-Informationen konnten nicht geladen werden","Loading app":"Lade Anwendung"},es:{},fr:{'"%{appName}" app content area':'Zone de contenu de l\'application "%{appName}"','"%{appName}" app page':'page de l\'application "%{appName}"',"Error in app server response":"Erreur dans la réponse du serveur","Error retrieving file information":"Erreur lors de la récupération des informations du fichier","Loading app":"Chargement de l'app"},gl:{},it:{"Loading app":"Caricamento app"}};const l={name:"ErrorScreen",props:{message:{default:"",type:String,required:!1}}};var c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-icon",{attrs:{size:"xxlarge",name:"error-warning","fill-type":"line"}}),e._v(" "),e.message?r("p",{staticClass:"oc-text-xlarge"},[e._v(e._s(e.message))]):e._e()],1)};c._withStripped=!0;const d=e.normalizeComponent({render:c,staticRenderFns:[]},undefined,l,undefined,false,undefined,!1,void 0,void 0,void 0);const m={name:"LoadingScreen"};var u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-spinner",{attrs:{size:"xlarge"}}),e._v(" "),r("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-invisible"},[e._v("Loading app")])],1)};u._withStripped=!0;const h=e.normalizeComponent({render:u,staticRenderFns:[]},undefined,m,undefined,false,undefined,!1,void 0,void 0,void 0);const f=e.defineComponent({name:"ExternalApp",components:{ErrorScreen:d,LoadingScreen:h},setup(){const r=i.useRouteQuery("app"),a=e.computed((()=>i.queryItemAsString(e.unref(r))));return{...t.useAppDefaults({applicationId:"external",applicationName:a}),applicationName:a}},data:()=>({loading:!1,loadingError:!1,errorMessage:"",appUrl:"",method:"",formParameters:{}}),computed:{...e.mapGetters(["capabilities"]),pageTitle(){const e=this.$gettext('"%{appName}" app page');return this.$gettextInterpolate(e,{appName:this.applicationName})},iFrameTitle(){const e=this.$gettext('"%{appName}" app content area');return this.$gettextInterpolate(e,{appName:this.applicationName})},fileId(){return this.$route.query.fileId}},async created(){this.loading=!0;try{const t=this.fileId||(await this.getFileInfo(this.currentFileContext,{davProperties:[a.DavProperty.FileId]})).fileId,i=a.urlJoin(r.configurationManager.serverUrl,this.capabilities.files.app_providers[0].open_url),n=`${i}?${e.lib.stringify({file_id:t,lang:this.$language.current,...this.applicationName&&{app_name:this.applicationName}})}`,s=await this.makeRequest("POST",n,{validateStatus:()=>!0});if(200!==s.status)return this.errorMessage=s.message,this.loading=!1,this.loadingError=!0,void console.error("Error fetching app information",s.status,this.errorMessage);if(!s.data.app_url||!s.data.method)return this.errorMessage=this.$gettext("Error in app server response"),this.loading=!1,this.loadingError=!0,void console.error("Error in app server response");this.appUrl=s.data.app_url,this.method=s.data.method,s.data.form_parameters&&(this.formParameters=s.data.form_parameters),"POST"===this.method&&this.formParameters&&this.$nextTick((()=>this.$refs.subm.click())),this.loading=!1}catch(e){this.errorMessage=this.$gettext("Error retrieving file information"),console.error("Error retrieving file information",e),this.loading=!1,this.loadingError=!0}}});var g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",{staticClass:"oc-height-1-1",class:{"oc-flex oc-flex-center oc-flex-middle":e.loading||e.loadingError}},[r("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),e.loading?r("loading-screen"):e.loadingError?r("error-screen",{attrs:{message:e.errorMessage}}):e._e(),e._v(" "),e.appUrl&&"GET"===e.method?r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{src:e.appUrl,title:e.iFrameTitle,allowfullscreen:""}}):e._e(),e._v(" "),e.appUrl&&"POST"===e.method&&e.formParameters?r("div",{staticClass:"oc-height-1-1"},[r("form",{attrs:{action:e.appUrl,target:"app-iframe",method:"post"}},[r("input",{ref:"subm",staticClass:"oc-hidden",attrs:{type:"submit"},domProps:{value:e.formParameters}}),e._v(" "),e._l(e.formParameters,(function(e,t,a){return r("div",{key:a},[r("input",{attrs:{name:t,type:"hidden"},domProps:{value:e}})])}))],2),e._v(" "),r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{name:"app-iframe",title:e.iFrameTitle,allowfullscreen:""}})]):e._e()],1)};g._withStripped=!0;return{appInfo:{name:"External",id:"external"},routes:[{name:"apps",path:"/:driveAliasAndItem*",component:e.normalizeComponent({render:g,staticRenderFns:[]},undefined,f,undefined,false,undefined,!1,void 0,void 0,void 0),meta:{authContext:"hybrid",patchCleanPath:!0}}],store:{namespaced:!0,state:{mimeTypes:[]},actions:{async fetchMimeTypes({rootGetters:t,commit:i}){if(!t.capabilities.files.app_providers[0]?.enabled)return;const n=a.urlJoin(r.configurationManager.serverUrl,t.capabilities.files.app_providers[0].apps_url),s=await fetch(n,{headers:{"X-Request-ID":e.v4()}});if(!s.ok)throw new Error("Error fetching app provider MIME types");const{"mime-types":o}=await s.json();i("SET_MIME_TYPES",o)}},mutations:{SET_MIME_TYPES(e,t){e.mimeTypes=t}},getters:{mimeTypes:e=>e.mimeTypes}},translations:p,ready:function(e){e.store.dispatch("External/fetchMimeTypes")}}}));
