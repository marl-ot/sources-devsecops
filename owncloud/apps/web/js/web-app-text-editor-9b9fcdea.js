define(["./chunks/_rollupPluginBabelHelpers-d0b0ebba","./chunks/vendor-22992e2c","./chunks/base-fbc1ccef","./chunks/useAppDefaults-a6c3be91","./chunks/visibility-c7f197c2","./chunks/functions-f74c7f04","./chunks/useTranslations-561064a5","./chunks/AppTopBar-4add792e","./chunks/useSpacesLoading-b404aeae","./chunks/useGraphClient-6c0c047b","./chunks/useDriveResolver-be2aa3cc"],(function(e,t,n,i,r,a,o,s,c,l,d){"use strict";const u=t.defineComponent({name:"TextEditor",components:{AppTopBar:s.__vue_component__},beforeRouteLeave(e,t,n){if(this.isDirty){const e={variation:"danger",icon:"warning",title:this.$gettext("Unsaved changes"),message:this.$gettext("Your changes were not saved. Do you want to save them?"),cancelText:this.$gettext("Don't Save"),confirmText:this.$gettext("Save"),onCancel:()=>{this.hideModal(),n()},onConfirm:async()=>{await this.save(),this.hideModal(),n()}};this.createModal(e)}else n()},setup(){const e=i.useAppDefaults({applicationId:"text-editor"}),{applicationConfig:s,currentFileContext:c,getFileInfo:l,getFileContents:d,putFileContents:u,replaceInvalidFileRoute:h}=e,f=t.ref(),p=t.ref(),v=t.ref(),g=t.ref(!0),m=t.ref(),w=r.useStore(),{$gettext:x,$gettextInterpolate:b}=o.useTranslations(),y=e=>{w.dispatch("showMessage",{title:x("An error occurred"),desc:e,status:"danger"})},P=t.C((function*(){m.value=yield l(c,{davProperties:[n.DavProperty.FileId,n.DavProperty.Permissions,n.DavProperty.Name]}),h(c,t.unref(m)),g.value=![n.DavPermission.Updateable,n.DavPermission.FileUpdateable].some((e=>(m.value.permissions||"").indexOf(e)>-1));const e=yield d(c);f.value=p.value=e.body,v.value=e.headers["OC-ETag"]})).restartable(),D=t.C((function*(){const e=t.unref(p);try{const n=yield u(c,{content:e,previousEntityTag:t.unref(v)});f.value=e,v.value=n.etag}catch(e){switch(e.statusCode){case 412:y(x("This file was updated outside this window. Please refresh the page (all changes will be lost)."));break;case 500:y(x("Error when contacting the server"));break;case 507:if(w.getters["runtime/spaces/spaces"].find((e=>e.id===t.unref(m).storageId&&a.isProjectSpaceResource(e)))){y(x("Error when contacting the server"));break}y(x("Error when contacting the server"));break;case 401:y(x("You're not authorized to save this file"));break;default:y(e.message||e)}}})).restartable();t.watch(c,(()=>{P.perform()}),{immediate:!0});const k=t.computed((()=>t.unref(p)&&E?t.sanitizeHtml_1(t.marked_umd.marked(t.unref(p))):null)),M=t.computed((()=>t.unref(f)!==t.unref(p))),S=t.computed((()=>P.isError)),C=t.computed((()=>P.isRunning||D.isRunning)),E=t.computed((()=>"md"===t.unref(F)||!t.unref(L).showPreviewOnlyMd)),F=t.computed((()=>t.unref(t.unref(c).path).split(".").pop())),L=t.computed((()=>{const{showPreviewOnlyMd:e=!0}=t.unref(s);return{showPreviewOnlyMd:e}}));t.onMounted((()=>{document.addEventListener("keydown",_,!1),window.addEventListener("beforeunload",A)})),t.onBeforeUnmount((()=>{window.removeEventListener("beforeunload",A),document.removeEventListener("keydown",_,!1)}));const T=async function(){await D.perform()},_=function(e){(e.ctrlKey||e.metaKey)&&"KeyS"===e.code&&(e.preventDefault(),T())},A=function(e){t.unref(M)&&(e.preventDefault(),e.returnValue="")};return{...e,loadFileTask:P,saveFileTask:D,isLoading:C,isError:S,showPreview:E,isDirty:M,isReadOnly:g,currentContent:p,renderedMarkdown:k,config:L,resource:m,save:T,handleSKey:_,handleUnload:A}},methods:{...t.mapActions(["createModal","hideModal"])}});var h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"oc-height-1-1",attrs:{id:"text-editor"}},[n("app-top-bar",{attrs:{resource:e.resource},on:{close:e.closeApp},scopedSlots:e._u([{key:"right",fn:function(){return[e.isLoading?e._e():n("oc-button",{attrs:{id:"text-editor-controls-save","aria-label":e.$gettext("Save"),disabled:e.isReadOnly||!e.isDirty},on:{click:e.save}},[n("oc-icon",{attrs:{name:"save",size:"small"}})],1)]},proxy:!0}])}),e._v(" "),e.isLoading?n("div",{staticClass:"oc-text-center"},[n("oc-spinner",{attrs:{"aria-label":e.$gettext("Loading editor content")}})],1):e.isError?n("div",{staticClass:"oc-text-center"},[n("div",{staticClass:"oc-position-center oc-text-center"},[n("oc-icon",{attrs:{size:"xxlarge",name:"error-warning","fill-type":"line"}})],1)]):n("div",{staticClass:"oc-flex editor-wrapper-height oc-px-s oc-pt-rm oc-pb-s"},[n("div",{staticClass:"oc-height-1-1",class:e.showPreview?"oc-width-1-2":"oc-width-1-1"},[n("oc-textarea",{staticClass:"oc-height-1-1",attrs:{id:"text-editor-input",name:"input","full-width":"",label:"",rows:20,disabled:e.isReadOnly},model:{value:e.currentContent,callback:function(t){e.currentContent=t},expression:"currentContent"}})],1),e._v(" "),e.showPreview?n("div",{staticClass:"oc-container oc-width-1-2"},[n("div",{attrs:{id:"text-editor-preview"},domProps:{innerHTML:e._s(e.renderedMarkdown)}})]):e._e()])],1)};h._withStripped=!0;var f={cs:{Save:"Uložit"},de:{"An error occurred":"Ein Fehler ist aufgetreten","Don't Save":"Verwerfen","Error when contacting the server":"Fehler beim Kontaktieren des Servers",extensionItem:"Erweiterungselement","JavaScript file":"JavaScript-Datei","JSON file":"JSON-Datei","Loading editor content":"Lade Editor Inhalt","Markdown file":"Markdown-Datei",msg:"Nachricht","PHP file":"PHP-Datei","Plain text file":"Text-Datei","Python file":"Python-Datei",Save:"Speichern","Text Editor":"Texteditor","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Die Datei wurde außerhalb des Fensters aktualisiert. Bitte die Seite neu laden (alle Änderungen gehen verloren).","Unsaved changes":"Ungespeicherte Änderungen","XML file":"XML-Datei","YAML file":"YAML-Datei","You're not authorized to save this file":"Keine ausreichenden Berechtigungen für das Speichern der Datei ","Your changes were not saved. Do you want to save them?":"Ungesicherte Änderungen. Möchtest Du sie speichern? "},es:{"Loading editor content":"Cargando el editor de contenido",msg:"msg",Save:"Guardar"},fr:{"An error occurred":"Une erreur est survenue","Don't Save":"Ne pas enregistrer","Error when contacting the server":"Erreur de communication avec le serveur","JavaScript file":"Fichier JavaScript","JSON file":"Fichier JSON","Loading editor content":"Chargement du contenu de l'éditeur","Markdown file":"Fichier Markdown",msg:"msg","PHP file":"Fichier PHP","Plain text file":"Fichier texte brut","Python file":"Fichier Python",Save:"Sauvegarder","Text Editor":"Éditeur de texte","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Ce fichier a été modifié en dehors de cette fenêtre. Veuillez rafraîchir la page (tous les changements seront perdus).","Unsaved changes":"Modifications non enregistrées","XML file":"Fichier XML","YAML file":"Fichier YAML","You're not authorized to save this file":"Vous n'êtes pas autorisé à enregistrer ce fichier","Your changes were not saved. Do you want to save them?":"Les modifications n'ont pas été enregistrées, souhaitez-vous les enregistrer ?"},gl:{msg:"msx",Save:"Gardar"},it:{}};var p,v,g="text-editor",m=[{path:"/:driveAliasAndItem*",component:t.normalizeComponent({render:h,staticRenderFns:[]},undefined,u,undefined,false,undefined,!1,void 0,void 0,void 0),name:"text-editor",meta:{authContext:"hybrid",title:"Text Editor",patchCleanPath:!0}}];return{appInfo:{name:"Text Editor",id:g,icon:"file-text",isFileEditor:!0,extensions:(p=[{extension:"txt",label:"Plain text file"},{extension:"md",label:"Markdown file"},{extension:"js",label:"JavaScript file"},{extension:"json",label:"JSON file"},{extension:"xml",label:"XML file"},{extension:"py",label:"Python file"},{extension:"php",label:"PHP file"},{extension:"yaml",label:"YAML file"}],v=window.Vue.$store.getters.extensionConfigByAppId(g).primaryExtensions||["txt","md"],"string"==typeof v&&(v=[v]),p.reduce((function(e,t){var n=v.includes(t.extension);return t.canBeDefault=n,n&&(t.newFileMenu={menuTitle:function(e){return e(t.label)}}),e.push(t),e}),[])).map((function(t){return e._objectSpread2(e._objectSpread2({extension:t.extension},Object.prototype.hasOwnProperty.call(t,"newFileMenu")&&{newFileMenu:t.newFileMenu}),Object.prototype.hasOwnProperty.call(t,"canBeDefault")&&{canBeDefault:t.canBeDefault})}))},routes:m,translations:f}}));
