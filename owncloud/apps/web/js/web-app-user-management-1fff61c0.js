define(["./chunks/vendor-22992e2c","./chunks/_rollupPluginBabelHelpers-d0b0ebba","./chunks/visibility-c7f197c2","./chunks/QuotaSelect-f6082d31","./chunks/base-fbc1ccef","./chunks/useGraphClient-6c0c047b","./chunks/AppLoadingSpinner-348c6387"],(function(e,t,s,r,a,i,o){"use strict";var n={cs:{Actions:"Akce",Cancel:"Zrušit",Create:"Vytvořit",Delete:"Odstranit",Edit:"Upravit",Groups:"Skupiny",Password:"Heslo",Role:"Role",Users:"Uživatelé"},de:{"%{ groupCount } selected":"%{ groupCount } ausgewählt","%{ userCount } selected":"%{ userCount } ausgewählt","%{groupCount} groups in total":"%{groupCount} Gruppen gesamt","%{groupCount} matching groups":"%{groupCount} Gruppen Treffer","%{userCount} matching users":"%{userCount} Benutzer Treffer","%{userCount} users in total":"%{userCount} Benutzer gesamt",Actions:"Aktionen","Add or remove groups":"Gruppen entfernen oder hinzufügen","Are you sure you want to delete this group?":["Sicher, dass du diese Gruppe löschen möchtest?","Sicher, dass du alle ausgewählten Gruppen löschen möchtest?"],"Are you sure you want to delete this user?":["Sicher, dass du diesen Benutzer löschen möchtest?","Sicher, dass du alle ausgewählten Benutzer löschen möchtest?"],Cancel:"Abbrechen","Clear selection":"Auswahl aufheben","Close sidebar to hide details":"Seitenleiste schließen um Details zu verbergen",Create:"Erstellen","Create group":"Gruppe erstellen","Create user":"Benutzer erstellen",Delete:"Löschen","Delete group %{group}?":["Gruppe %{group} löschen?","Ausgewählte %{groupCount} Gruppen löschen?"],"Delete user %{user}?":["Benutzer %{user} löschen?","Ausgewählte %{userCount} Benutzer löschen?"],Details:"Details","Display name":"Anzeigename","Display name cannot be empty":"Anzeigename kann nicht leer sein",Edit:"Bearbeiten","Edit group":"Gruppe bearbeiten","Edit user":"Benutzer bearbeiten",Email:"E-Mail","Failed to create group":"Fehler beim Erstellen der Gruppe","Failed to create user":"Fehler beim Erstellen des Benutzers",'Failed to delete group "%{group}"':['Fehler beim Löschen der Gruppe "%{group}"',"Fehler beim Löschen von %{groupCount} Gruppen"],'Failed to delete user "%{user}"':['Fehler beim Löschen des Benutzers "%{user}"',"Fehler beim Löschen von %{userCount} Benutzern"],"Failed to edit group":"Fehler beim Bearbeiten der Gruppe","Failed to edit group assignments":"Gruppen konnten nicht zugewiesen werden","Failed to edit user":"Fehler beim Bearbeiten des Benutzers","Filter groups":"Gruppen suchen","Filter users":"Benutzer suchen","First and last name":"Vor- und Nachname",'Group "%{group}" was deleted successfully':['Gruppe "%{group}" wurde erfolgreich gelöscht',"%{groupCount} Gruppen wurden erfolgreich gelöscht"],'Group "%{groupName}" already exists':'Gruppe "%{groupName}" existiert bereits',"Group assignments":"Gruppenzuweisungen","Group details":"Gruppen-Details","Group name":"Gruppenname","Group name cannot be empty":"Gruppenname kann nicht leer sein","Group was created successfully":"Gruppe wurde erfolgreich erstellt","Group was edited successfully":"Gruppe wurde erfolgreich bearbeitet",Groups:"Gruppen",Members:"Mitglieder",msg:"Nachricht","New group":"Neue Gruppe","New user":"Neuer Benutzer","No groups in here":"Keine Gruppen vorhanden","No users in here":"Keine Benutzer vorhanden","Open sidebar to view details":"Seitenleiste schließen um Details anzuzeigen","Overview of the information about the selected group":"Überblick der Informationen zu der ausgewählten Gruppe","Overview of the information about the selected user":"Überblick der Informationen zu dem ausgewählten Benutzer",Password:"Passwort","Password cannot be empty":"Passwort kann nicht leer sein","Personal quota":"Persönliche Quota","Please enter a valid email":"Bitte eine gültige Email-Adresse eingeben",Role:"Rolle","Select %{ group }":"%{ group } auswählen","Select %{ user }":"%{ user } auswählen","Select a group to view details":"Gruppe auswählen um Details zu sehen","Select a user to view details":"Benutzer auswählen um Details zu sehen","Select all groups":"Alle Gruppen auswählen","Select all users":"Alle Benutzer auswählen","To set an individual quota, the user needs to have logged in once.":"Um eine individuelle Quota setzen zu können muss der Benutzer einmal angemeldet gewesen sein.",'User "%{user}" was deleted successfully':['Benutzer "%{user}" wurde erfolgreich gelöscht',"%{userCount} Benutzer wurden erfolgreich gelöscht"],'User "%{userName}" already exists':'Benutzer "%{userName}" ist bereits vorhanden',"User details":"Benutzer-Details","User management":"Benutzermanagement","User name":"Benutzername","User name cannot be empty":"Benutzername kann nicht leer sein","User name cannot contain white spaces":"Benutzername kann keine Leerzeichen enthalten","User name cannot start with a number":"Benutzername kann nicht mit einer Nummer anfangen","User was created successfully":"Benutzer wurde erfolgreich erstellt",Users:"Benutzer"},es:{Actions:"Acciones",Cancel:"Cancelar",Create:"Crear",Delete:"Eliminar","Display name":"Nombre a mostrar",Edit:"Editar",Email:"Correo electrónico",Groups:"Grupos",msg:"msg",Password:"Contraseña",Role:"Rol",Users:"Usuarios"},fr:{"%{ groupCount } selected":"%{ groupCount } sélectionnés","%{ userCount } selected":"%{ userCount } sélectionnés","%{groupCount} groups in total":"%{groupCount} groupes en tout","%{userCount} users in total":"%{userCount} utilisateurs en tout",Actions:"Actions","Add or remove groups":"Ajouter ou supprimer des groupes","Are you sure you want to delete this group?":["Êtes vous certain de vouloir supprimer ce groupe ?","Êtes vous certain de vouloir supprimer tous les groupes sélectionnés ?","Êtes vous certain de vouloir supprimer tous les groupes sélectionnés ?"],"Are you sure you want to delete this user?":["Êtes vous certain de vouloir supprimer cet utilisateur ?","Êtes vous certain de vouloir supprimer tous les utilisateurs sélectionnés ?","Êtes vous certain de vouloir supprimer tous les utilisateurs sélectionnés ?"],Cancel:"Annuler","Clear selection":"Annuler la sélection","Close sidebar to hide details":"Fermer le panneau latéral pour cacher les détails",Create:"Créer","Create group":"Créer un groupe","Create user":"Créer un utilisateur",Delete:"Supprimer","Delete group %{group}?":["Supprimer le groupe %{group} ?","Supprimer les %{groupCount} groupes sélectionnés ?","Supprimer les %{groupCount} groupes sélectionnés ?"],"Delete user %{user}?":["Supprimer l'utilisateur %{user} ?","Supprimer les %{userCount} utilisateurs sélectionnés ?","Supprimer les %{userCount} utilisateurs sélectionnés ?"],Details:"Détails","Display name":"Nom affiché","Display name cannot be empty":"Le nom affiché ne peut pas être vide",Edit:"Editer","Edit group":"Modifier le groupe","Edit user":"Modifier l'utilisateur",Email:"Email","Failed to create group":"Impossible de créer le groupe","Failed to create user":"Impossible de créer l'utilisateur",'Failed to delete group "%{group}"':['Impossible de supprimer le groupe "%{group}"',"Impossible de supprimer %{groupCount} groupes","Impossible de supprimer %{groupCount} groupes"],'Failed to delete user "%{user}"':['Impossible de supprimer l\'utilisateur "%{user}"',"Impossible de supprimer %{userCount} utilisateurs","Impossible de supprimer %{userCount} utilisateurs"],"Failed to edit group":"Échec de la modification du groupe","Failed to edit group assignments":"Échec de la modification d'affectation de groupe","Failed to edit user":"Échec de la modification de l'utilisateur","First and last name":"Prénom et nom",'Group "%{group}" was deleted successfully':['Le groupe "%{group}" a été supprimé avec succès',"%{groupCount} groupes ont été supprimés avec succès","%{groupCount} groupes ont été supprimés avec succès"],'Group "%{groupName}" already exists':'Le groupe "%{groupName}" existe déjà',"Group assignments":"Affectation de groupes","Group details":"Détails du groupe","Group name":"Nom du groupe","Group name cannot be empty":"Le nom du groupe ne peut pas être vide","Group was created successfully":"Le groupe a été créé avec succès","Group was edited successfully":"Le groupe a été modifié correctement",Groups:"Groupes",Members:"Membres",msg:"msg","New group":"Nouveau groupe","New user":"Nouvel utilisateur","No groups in here":"Aucun groupe","No users in here":"Aucun utilisateur","Open sidebar to view details":"Ouvrir le panneau latéral pour voir les détails","Overview of the information about the selected group":"Aperçu des informations sur le groupe sélectionné","Overview of the information about the selected user":"Aperçu des informations sur l'utilisateur sélectionné",Password:"Mot de passe","Password cannot be empty":"Le mot de passe ne peut pas être vide","Please enter a valid email":"Veuillez renseigner une adresse email valide",Role:"Rôle","Select %{ group }":"Sélectionner %{ group }","Select %{ user }":"Sélectionner %{ user }","Select a group to view details":"Sélectionnez un groupe pour voir les détails","Select a user to view details":"Sélectionnez un utilistaue pour voir les détails","Select all groups":"Sélectionner tous les groupes","Select all users":"Sélectionner tous les utilisateurs",'User "%{user}" was deleted successfully':["%{userCount} utilisateur a été supprimé avec succès","%{userCount} utilisateurs ont été supprimés avec succès","%{userCount} utilisateurs ont été supprimés avec succès"],'User "%{userName}" already exists':'L\'utilisateur "%{userName}" existe déjà',"User details":"Détails de l'utilisateur","User management":"Gestion des utilisateurs","User name":"Identifiant utilisateur","User name cannot be empty":"L'identifiant utilisateur ne peut pas être vide","User name cannot contain white spaces":"L'identifiant d'utilisateur ne peut pas contenir d'espace","User name cannot start with a number":"Le nom d'utilisateur ne peut pas commencer par un chiffre","User was created successfully":"L'utilisateur a été créé avec succès",Users:"Utilisateurs"},gl:{Actions:"Accións",Cancel:"Cancelar","Clear selection":"Limpar a selección",Create:"Crear",Delete:"Eliminar",Edit:"Editar",Groups:"Grupos",msg:"msx",Password:"Contrasinal",Role:"Rol",Users:"Usuarios"},it:{"Display name":"Mostra nome",Edit:"Modifica",Email:"Email"}};const l={name:"UsersList",props:{users:{type:Array,required:!0},selectedUsers:{type:Array,required:!0},headerPosition:{type:Number,required:!0}},data:function(){return{sortBy:"onPremisesSamAccountName",sortDir:"asc",markInstance:null,filterTerm:""}},computed:{allUsersSelected:function(){return this.users.length===this.selectedUsers.length},footerTextTotal:function(){var e=this.$gettext("%{userCount} users in total");return this.$gettextInterpolate(e,{userCount:this.users.length})},footerTextFilter:function(){var e=this.$gettext("%{userCount} matching users");return this.$gettextInterpolate(e,{userCount:this.data.length})},fields:function(){return[{name:"select",title:"",type:"slot",width:"shrink",headerType:"slot"},{name:"avatar",title:"",type:"slot",width:"shrink"},{name:"onPremisesSamAccountName",title:this.$gettext("User name"),sortable:!0},{name:"displayName",title:this.$gettext("First and last name"),sortable:!0},{name:"mail",title:this.$gettext("Email"),sortable:!0},{name:"role",title:this.$gettext("Role"),type:"slot",sortable:!0},{name:"actions",title:this.$gettext("Actions"),sortable:!1,type:"slot",alignH:"right"}]},data:function(){var e=this.orderBy(this.users,this.sortBy,"desc"===this.sortDir);return this.filter(e,this.filterTerm)},highlighted:function(){return this.selectedUsers.map((function(e){return e.id}))}},watch:{filterTerm:function(){this.markInstance&&(this.markInstance.unmark(),this.markInstance.mark(this.filterTerm,{element:"span",className:"highlight-mark",exclude:["th *","tfoot *"]}))}},mounted:function(){var t=this;this.$nextTick((function(){t.markInstance=new e.mark(t.$refs.table.$el)}))},methods:{filter:function(t,s){return(s||"").trim()?new e.Fuse(t,{includeScore:!0,useExtendedSearch:!0,threshold:.3,keys:["displayName","mail","onPremisesSamAccountName","role.displayName"]}).search(s).map((function(e){return e.item})):t},orderBy:function(e,s,r){return t._toConsumableArray(e).sort((function(e,t){var a,i,o,n;"role"===s?(a=(null===(o=e.role)||void 0===o?void 0:o.displayName)||"",i=(null===(n=t.role)||void 0===n?void 0:n.displayName)||""):(a=e[s]||"",i=t[s]||"");return r?i.localeCompare(a):a.localeCompare(i)}))},handleSort:function(e){this.sortBy=e.sortBy,this.sortDir=e.sortDir},getSelectUserLabel:function(e){var t=this.$gettext("Select %{ user }");return this.$gettextInterpolate(t,{user:e.displayName},!0)}}};var u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-text-input",{staticClass:"oc-ml-m oc-my-s",attrs:{id:"users-filter",label:e.$gettext("Filter users"),autocomplete:"off"},model:{value:e.filterTerm,callback:function(t){e.filterTerm=t},expression:"filterTerm"}}),e._v(" "),s("oc-table",{ref:"table",staticClass:"users-table",attrs:{"sort-by":e.sortBy,"sort-dir":e.sortDir,fields:e.fields,data:e.data,highlighted:e.highlighted,sticky:!0,"header-position":e.headerPosition},on:{sort:e.handleSort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",label:e.$gettext("Select all users"),value:e.allUsersSelected,"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectAllUsers")}}})]},proxy:!0},{key:"select",fn:function(t){var r=t.item;return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",value:e.selectedUsers,option:r,label:e.getSelectUserLabel(r),"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectUser",r)}}})]}},{key:"avatar",fn:function(e){var t=e.item;return[s("avatar-image",{attrs:{width:32,userid:t.id,"user-name":t.displayName}})]}},{key:"role",fn:function(t){var s=t.item;return[s.role?[e._v(e._s(s.role.displayName))]:e._e()]}},{key:"actions",fn:function(t){var r=t.item;return[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Details"),expression:"$gettext('Details')"}],staticClass:"oc-mr-xs quick-action-button oc-p-xs",attrs:{appearance:"raw"},on:{click:function(t){return e.$emit("showPanel",{user:r,panel:"DetailsPanel"})}}},[s("oc-icon",{attrs:{name:"information","fill-type":"line"}})],1),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Group assignments"),expression:"$gettext('Group assignments')"}],staticClass:"oc-mr-xs quick-action-button oc-p-xs",attrs:{appearance:"raw"},on:{click:function(t){return e.$emit("showPanel",{user:r,panel:"GroupAssignmentsPanel"})}}},[s("oc-icon",{attrs:{name:"group-2","fill-type":"line"}})],1),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Edit"),expression:"$gettext('Edit')"}],staticClass:"oc-mr-xs quick-action-button oc-p-xs",attrs:{appearance:"raw"},on:{click:function(t){return e.$emit("showPanel",{user:r,panel:"EditPanel"})}}},[s("oc-icon",{attrs:{name:"pencil","fill-type":"line"}})],1)]}},{key:"footer",fn:function(){return[s("div",{staticClass:"oc-text-nowrap oc-text-center oc-width-1-1 oc-my-s"},[s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerTextTotal))]),e._v(" "),e.filterTerm?s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerTextFilter))]):e._e()])]},proxy:!0}])})],1)};u._withStripped=!0;const c=e.normalizeComponent({render:u,staticRenderFns:[]},undefined,l,undefined,false,undefined,!1,void 0,void 0,void 0);const d={name:"CreateUserModal",props:{existingUsers:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{formData:{userName:{errorMessage:"",valid:!1},displayName:{errorMessage:"",valid:!1},email:{errorMessage:"",valid:!1},password:{errorMessage:"",valid:!1}},user:{onPremisesSamAccountName:"",displayName:"",mail:"",passwordProfile:{password:""}}}},computed:{buttonConfirmDisabled:function(){var e=this;return Object.keys(this.formData).map((function(t){return!!e.formData[t].valid})).includes(!1)}},methods:{onInputEmail:function(){e.validate(this.user.mail)&&(this.formData.email.errorMessage="",this.formData.email.valid=!0)},validateUserName:function(){var e=this;return this.formData.userName.valid=!1,""===this.user.onPremisesSamAccountName.trim()?(this.formData.userName.errorMessage=this.$gettext("User name cannot be empty"),!1):this.user.onPremisesSamAccountName.includes(" ")?(this.formData.userName.errorMessage=this.$gettext("User name cannot contain white spaces"),!1):this.user.onPremisesSamAccountName.length&&!isNaN(this.user.onPremisesSamAccountName[0])?(this.formData.userName.errorMessage=this.$gettext("User name cannot start with a number"),!1):this.existingUsers.find((function(t){return t.onPremisesSamAccountName===e.user.onPremisesSamAccountName}))?(this.formData.userName.errorMessage=this.$gettextInterpolate(this.$gettext('User "%{userName}" already exists'),{userName:this.user.onPremisesSamAccountName}),!1):(this.formData.userName.errorMessage="",this.formData.userName.valid=!0,!0)},validateDisplayName:function(){return this.formData.displayName.valid=!1,""===this.user.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Display name cannot be empty"),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)},validateEmail:function(){return this.formData.email.valid=!1,e.validate(this.user.mail)?(this.formData.email.errorMessage="",this.formData.email.valid=!0,!0):(this.formData.email.errorMessage=this.$gettext("Please enter a valid email"),!1)},validatePassword:function(){return this.formData.password.valid=!1,""===this.user.passwordProfile.password.trim()?(this.formData.password.errorMessage=this.$gettext("Password cannot be empty"),!1):(this.formData.password.errorMessage="",this.formData.password.valid=!0,!0)}}};var p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-modal",{attrs:{title:e.$gettext("Create user"),"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Create"),"button-confirm-disabled":e.buttonConfirmDisabled,"focus-trap-initial":"#create-user-input-display-name"},on:{cancel:function(t){return e.$emit("cancel")},confirm:function(t){return e.$emit("confirm",e.user)}},scopedSlots:e._u([{key:"content",fn:function(){return[s("form",{attrs:{autocomplete:"off"}},[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"create-user-input-display-name",label:e.$gettext("User name")+"*","error-message":e.formData.userName.errorMessage,"fix-message-line":!0},on:{input:e.validateUserName},model:{value:e.user.onPremisesSamAccountName,callback:function(t){e.$set(e.user,"onPremisesSamAccountName",t)},expression:"user.onPremisesSamAccountName"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("First and last name")+"*","error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.user.displayName,callback:function(t){e.$set(e.user,"displayName",t)},expression:"user.displayName"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("Email")+"*","error-message":e.formData.email.errorMessage,type:"email","fix-message-line":!0},on:{input:e.onInputEmail,change:e.validateEmail},model:{value:e.user.mail,callback:function(t){e.$set(e.user,"mail",t)},expression:"user.mail"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("Password")+"*","error-message":e.formData.password.errorMessage,type:"password","fix-message-line":!0},on:{input:e.validatePassword},model:{value:e.user.passwordProfile.password,callback:function(t){e.$set(e.user.passwordProfile,"password",t)},expression:"user.passwordProfile.password"}})],1)]},proxy:!0}])})};p._withStripped=!0;const m=e.normalizeComponent({render:p,staticRenderFns:[]},undefined,d,undefined,false,undefined,!1,void 0,void 0,void 0);const g={name:"DeleteUserModal",props:{users:{type:Array,required:!0}},computed:{title:function(){return this.$gettextInterpolate(this.$ngettext("Delete user %{user}?","Delete %{userCount} selected users?",this.users.length),{userCount:this.users.length,user:this.users[0].onPremisesSamAccountName})},message:function(){return this.$ngettext("Are you sure you want to delete this user?","Are you sure you want to delete all selected users?",this.users.length)}}};var h=function(){var e=this,t=e.$createElement;return(e._self._c||t)("oc-modal",{attrs:{icon:"alarm-warning",title:e.title,message:e.message,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Delete"),variation:"danger"},on:{confirm:function(t){return e.$emit("confirm",e.users)},cancel:function(t){return e.$emit("cancel")}}})};h._withStripped=!0;const f=e.normalizeComponent({render:h,staticRenderFns:[]},undefined,g,undefined,false,undefined,!1,void 0,void 0,void 0);const v={name:"UserInfoBox",props:{user:{type:Object,required:!0}}};var b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex user-info oc-mb-l"},[s("avatar-image",{staticClass:"oc-mb-m",attrs:{width:80,userid:e.user.id,"user-name":e.user.displayName}}),e._v(" "),s("span",{domProps:{textContent:e._s(e.user.onPremisesSamAccountName)}}),e._v(" "),s("span",{staticClass:"oc-text-muted user-info-display-name",domProps:{textContent:e._s(e.user.displayName)}})],1)};b._withStripped=!0;const x=e.normalizeComponent({render:b,staticRenderFns:[]},undefined,v,undefined,false,undefined,!1,void 0,void 0,void 0);const y={name:"DetailsPanel",components:{UserInfoBox:x},props:{users:{type:Array,required:!0}},computed:{user:function(){return 1===this.users.length?this.users[0]:null},noUsers:function(){return!this.users.length},multipleUsers:function(){return this.users.length>1},multipleUsersSelectedText:function(){return this.$gettextInterpolate("%{count} users selected",{count:this.users.length})}}};var C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mt-xl"},[e.noUsers?s("div",{staticClass:"oc-flex user-info"},[s("oc-icon",{attrs:{name:"user",size:"xxlarge"}}),e._v(" "),s("p",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("Select a user to view details")])],1):e._e(),e._v(" "),e.multipleUsers?s("div",{staticClass:"oc-flex group-info"},[s("oc-icon",{attrs:{name:"group",size:"xxlarge"}}),e._v(" "),s("p",[e._v(e._s(e.multipleUsersSelectedText))])],1):e._e(),e._v(" "),e.user?s("div",[s("UserInfoBox",{attrs:{user:e.user}}),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.$gettext("Overview of the information about the selected user")}},[s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("User name"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.user.onPremisesSamAccountName)}})]),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Display name"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.user.displayName)}})]),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Email"))}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.user.mail)}})])]),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Role"))}}),e._v(" "),s("td",[e.user.role?s("span",{domProps:{textContent:e._s(e.user.role.displayName)}}):e._e()])])])],1):e._e()])};C._withStripped=!0;const w=e.normalizeComponent({render:C,staticRenderFns:[]},undefined,y,undefined,false,undefined,!1,void 0,void 0,void 0);const _=e.defineComponent({name:"CompareSaveDialog",props:{originalObject:{type:Object,required:!0},compareObject:{type:Object,required:!0},confirmButtonDisabled:{type:Boolean,default:()=>!1}},data:()=>({saved:!1}),computed:{unsavedChanges(){return!e.isEqual(this.originalObject,this.compareObject)},unsavedChangesText(){return this.unsavedChanges?this.$gettext("Unsaved changes"):this.$gettext("No changes")}},watch:{unsavedChanges(){this.unsavedChanges&&(this.saved=!1)},"originalObject.id":function(){this.saved=!1}},mounted(){const e=s.eventBus.subscribe("sidebar.entity.saved",(()=>{this.saved=!0}));this.$on("beforeDestroy",(()=>s.eventBus.unsubscribe("sidebar.entity.saved",e)))}});var $=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"compare-save-dialog oc-width-1-1 oc-flex oc-flex-between oc-flex-middle"},[e.saved?s("span",{staticClass:"state-indicator oc-flex oc-flex-middle"},[s("oc-icon",{attrs:{variation:"success",name:"checkbox-circle"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"changes-saved oc-ml-s"},[e._v("Changes saved")])],1):s("span",{staticClass:"state-indicator"},[e._v(e._s(e.unsavedChangesText))]),e._v(" "),s("div",[s("oc-button",{attrs:{disabled:!e.unsavedChanges},on:{click:function(t){return e.$emit("revert")}}},[s("translate",[e._v("Revert")])],1),e._v(" "),s("oc-button",{attrs:{appearance:"filled",variation:"primary",disabled:!e.unsavedChanges||e.confirmButtonDisabled},on:{click:function(t){return e.$emit("confirm")}}},[s("translate",[e._v("Save")])],1)],1)])};$._withStripped=!0;const U=e.normalizeComponent({render:$,staticRenderFns:[]},undefined,_,"data-v-316a4bcc",false,undefined,!1,void 0,void 0,void 0);const G={name:"EditPanel",components:{UserInfoBox:x,CompareSaveDialog:U,QuotaSelect:r.__vue_component__$2},props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},data:function(){return{editUser:{},formData:{displayName:{errorMessage:"",valid:!0},email:{errorMessage:"",valid:!0}}}},computed:{invalidFormData:function(){return Object.values(this.formData).map((function(e){return!!e.valid})).includes(!1)},showQuota:function(){return this.editUser.drive},compareSaveDialogOriginalObject:function(){return e.cloneDeep(t._objectSpread2(t._objectSpread2({},this.user),{},{passwordProfile:{password:""}}))}},watch:{user:{handler:function(){this.editUser=e.cloneDeep(t._objectSpread2(t._objectSpread2({},this.user),{},{passwordProfile:{password:""}}))},deep:!0,immediate:!0}},methods:{changeSelectedQuotaOption:function(e){this.editUser.drive.quota.total=e.value},validateDisplayName:function(){return this.formData.displayName.valid=!1,""===this.editUser.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Display name cannot be empty"),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)},validateEmail:function(){return this.formData.email.valid=!1,e.validate(this.editUser.mail)?(this.formData.email.errorMessage="",this.formData.email.valid=!0,!0):(this.formData.email.errorMessage=this.$gettext("Please enter a valid email"),!1)},revertChanges:function(){this.editUser=e.cloneDeep(t._objectSpread2(t._objectSpread2({},this.user),{},{passwordProfile:{password:""}})),Object.values(this.formData).forEach((function(e){e.valid=!0,e.errorMessage=""}))}}};var D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mt-xl",attrs:{id:"user-edit-panel"}},[s("UserInfoBox",{attrs:{user:e.user}}),e._v(" "),s("form",{staticClass:"oc-background-highlight oc-p-m",attrs:{id:"user-edit-form",autocomplete:"off"}},[s("div",[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("First and last name"),"error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.editUser.displayName,callback:function(t){e.$set(e.editUser,"displayName",t)},expression:"editUser.displayName"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("Email"),"error-message":e.formData.email.errorMessage,type:"email","fix-message-line":!0},on:{change:e.validateEmail},model:{value:e.editUser.mail,callback:function(t){e.$set(e.editUser,"mail",t)},expression:"editUser.mail"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("Password"),type:"password","fix-message-line":!0,"default-value":"●●●●●●●●"},model:{value:e.editUser.passwordProfile.password,callback:function(t){e.$set(e.editUser.passwordProfile,"password",t)},expression:"editUser.passwordProfile.password"}}),e._v(" "),s("div",{staticClass:"oc-mb-s"},[s("oc-select",{attrs:{label:e.$gettext("Role"),"option-label":"displayName",options:e.roles,clearable:!1},model:{value:e.editUser.role,callback:function(t){e.$set(e.editUser,"role",t)},expression:"editUser.role"}}),e._v(" "),s("div",{staticClass:"oc-text-input-message"})],1),e._v(" "),e.showQuota?s("quota-select",{key:"quota-select-"+e.user.id,staticClass:"oc-mb-s",attrs:{title:e.$gettext("Personal quota"),"total-quota":e.editUser.drive.quota.total||0},on:{selectedOptionChange:e.changeSelectedQuotaOption}}):s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-mb-s oc-mt-rm oc-text-meta"},[e._v("\n        To set an individual quota, the user needs to have logged in once.\n      ")])],1),e._v(" "),s("compare-save-dialog",{staticClass:"edit-compare-save-dialog oc-mb-l",attrs:{"original-object":e.compareSaveDialogOriginalObject,"compare-object":e.editUser,"confirm-button-disabled":e.invalidFormData},on:{revert:e.revertChanges,confirm:function(t){return e.$emit("confirm",e.editUser)}}})],1)],1)};D._withStripped=!0;const S=e.normalizeComponent({render:D,staticRenderFns:[]},undefined,G,undefined,false,undefined,!1,void 0,void 0,void 0);const N={name:"GroupAssignmentsPanel",components:{UserInfoBox:x,CompareSaveDialog:U},props:{user:{type:Object,required:!0},groups:{type:Array,required:!0}},data:function(){return{editUser:{}}},watch:{user:{handler:function(){this.editUser=t._objectSpread2({},this.user)},deep:!0,immediate:!0}},methods:{revertChanges:function(){this.editUser=t._objectSpread2({},this.user)}}};var P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mt-xl",attrs:{id:"user-group-assignment-panel"}},[s("UserInfoBox",{attrs:{user:e.user}}),e._v(" "),s("div",{staticClass:"oc-background-highlight oc-p-m",attrs:{id:"user-group-assignment-form"}},[s("oc-select",{staticClass:"oc-mb-s",attrs:{multiple:"",options:e.groups,"option-label":"displayName",label:e.$gettext("Add or remove groups"),"fix-message-line":!0},scopedSlots:e._u([{key:"selected-option",fn:function(t){var r=t.displayName,a=t.id;return[s("span",{staticClass:"oc-flex oc-flex-center"},[s("avatar-image",{staticClass:"oc-flex oc-align-self-center oc-mr-s",attrs:{width:16.8,userid:a,"user-name":r}}),e._v(" "),s("span",[e._v(e._s(r))])],1)]}},{key:"option",fn:function(t){var r=t.displayName,a=t.id;return[s("div",{staticClass:"oc-flex"},[s("span",{staticClass:"oc-flex oc-flex-center"},[s("avatar-image",{staticClass:"oc-flex oc-align-self-center oc-mr-s",attrs:{width:16.8,userid:a,"user-name":r}}),e._v(" "),s("span",[e._v(e._s(r))])],1)])]}}]),model:{value:e.editUser.memberOf,callback:function(t){e.$set(e.editUser,"memberOf",t)},expression:"editUser.memberOf"}}),e._v(" "),s("compare-save-dialog",{staticClass:"edit-compare-save-dialog oc-mb-l",attrs:{"original-object":e.user,"compare-object":e.editUser},on:{revert:e.revertChanges,confirm:function(t){return e.$emit("confirm",e.editUser)}}})],1)],1)};P._withStripped=!0;const B=e.normalizeComponent({render:P,staticRenderFns:[]},undefined,N,undefined,false,undefined,!1,void 0,void 0,void 0);const A=e.defineComponent({components:{SideBar:r.__vue_component__,AppLoadingSpinner:o.__vue_component__},props:{loading:{required:!0,type:Boolean},breadcrumbs:{required:!0,type:Array},sideBarOpen:{required:!0,type:Boolean},sideBarAvailablePanels:{required:!0,type:Array},sideBarActivePanel:{required:!0,type:String}},computed:{toggleSidebarButtonLabel(){return this.sideBarOpen?this.$gettext("Close sidebar to hide details"):this.$gettext("Open sidebar to view details")},toggleSidebarButtonIconFillType(){return this.sideBarOpen?"fill":"line"}}});var k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"oc-flex oc-height-1-1 app-content oc-width-1-1"},[e.loading?s("app-loading-spinner"):[s("div",{staticClass:"oc-width-expand",attrs:{id:"user-management-wrapper"}},[s("div",{ref:"appBar",staticClass:"oc-app-bar oc-py-s",attrs:{id:"user-management-app-bar"}},[s("div",{staticClass:"oc-flex oc-flex-between"},[s("oc-breadcrumb",{staticClass:"oc-flex oc-flex-middle",attrs:{items:e.breadcrumbs}}),e._v(" "),s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.toggleSidebarButtonLabel,expression:"toggleSidebarButtonLabel"}],staticClass:"oc-my-s oc-p-xs",attrs:{id:"files-toggle-sidebar","aria-label":e.toggleSidebarButtonLabel,appearance:"raw"},on:{click:function(t){return t.stopPropagation(),e.$emit("toggleSideBar")}}},[s("oc-icon",{attrs:{name:"side-bar-right","fill-type":e.toggleSidebarButtonIconFillType}})],1)],1)],1),e._v(" "),e._t("topbarActions")],2),e._v(" "),e._t("mainContent")],2),e._v(" "),e.sideBarOpen?s("side-bar",{attrs:{"active-panel":e.sideBarActivePanel,"available-panels":e.sideBarAvailablePanels,loading:!1,open:e.sideBarOpen},on:{selectPanel:function(t){return e.$emit("selectPanel",t)},close:function(t){return e.$emit("closeSideBar")}}}):e._e()]],2)};k._withStripped=!0;const M=e.normalizeComponent({render:k,staticRenderFns:[]},undefined,A,undefined,false,undefined,!1,void 0,void 0,void 0);const O=e.defineComponent({name:"UsersView",components:{AppTemplate:M,UsersList:c,NoContentMessage:r.__vue_component__$1,CreateUserModal:m,DeleteUserModal:f},setup(){const t=s.useStore(),r=e.ref([]),a=e.ref([]),o=e.ref([]),n=e.ref({}),l=i.useAccessToken({store:t}),{graphClient:u}=i.useGraphClient(),c=e.C((function*(t){const s=yield e.axios.post("/api/v0/settings/roles-list",{},{headers:{authorization:`Bearer ${e.unref(l)}`,"X-Request-ID":e.v4()}});o.value=s.data.bundles})),d=e.C((function*(t,s){const r=yield e.axios.post("/api/v0/settings/assignments-list",{account_uuid:s.user?.id},{headers:{authorization:`Bearer ${e.unref(l)}`,"X-Request-ID":e.v4()}}),a=r.data?.assignments;s.user.role={};const i=a.find((e=>"roleId"in e));if(i){const e=o.value.find((e=>e.id===i.roleId));e&&(s.user.role=e)}n.value[s.user?.id]=r.data?.assignments})),p=e.C((function*(t){const s=yield e.unref(u).groups.listGroups();a.value=s.data.value})),m=e.C((function*(t){const s=yield e.unref(u).users.listUsers("displayName");r.value=s.data.value||[],r.value.forEach((e=>{e.memberOf=e.memberOf||[]})),yield p.perform(),yield c.perform();for(const e of r.value)try{yield d.perform({user:e})}catch(t){console.error(`Failed to load role for user '${e.displayName}'`)}})),g=e.C((function*(t,s,r){const{data:a}=yield e.unref(u).users.getUser(r.id);a.drive&&(r.drive=a.drive,r.drive.quota||(r.drive.quota={total:0}))}));return{users:r,roles:o,groups:a,loadResourcesTask:m,loadAdditionalUserDataTask:g,graphClient:u,accessToken:l}},data:function(){return{listHeaderPosition:0,selectedUsers:[],createUserModalOpen:!1,deleteUserModalOpen:!1,sideBarOpen:!1,sideBarActivePanel:"DetailsPanel"}},computed:{...e.mapGetters(["configuration"]),...e.mapState({currentUser:"user"}),selectedUsersText(){const e=this.$gettext("%{ userCount } selected");return this.$gettextInterpolate(e,{userCount:this.selectedUsers.length})},breadcrumbs(){return[{text:this.$gettext("User management"),to:{path:"/user-management"}},{text:this.$gettext("Users"),onClick:()=>s.eventBus.publish("app.user-management.list.load")}]},allUsersSelected(){return this.users.length===this.selectedUsers.length},sideBarAvailablePanels(){return[{app:"DetailsPanel",icon:"user",title:this.$gettext("User details"),component:w,default:!0,enabled:!0,componentAttrs:{users:this.selectedUsers}},{app:"EditPanel",icon:"pencil",title:this.$gettext("Edit user"),component:S,default:!1,enabled:1===this.selectedUsers.length,componentAttrs:{user:this.selectedUsers[0],roles:this.roles},componentListeners:{confirm:this.editUser}},{app:"GroupAssignmentsPanel",icon:"group-2",title:this.$gettext("Group assignments"),component:B,default:!1,enabled:1===this.selectedUsers.length,componentAttrs:{user:this.selectedUsers[0],groups:this.groups},componentListeners:{confirm:this.editUserGroupAssignments}}]}},watch:{selectedUsers(){(!this.selectedUsers.length||this.selectedUsers.length>1)&&(this.sideBarActivePanel="DetailsPanel")}},async mounted(){await this.loadResourcesTask.perform(this);const e=s.eventBus.subscribe("app.user-management.list.load",(()=>{this.loadResourcesTask.perform(this)}));this.calculateListHeaderPosition(),window.addEventListener("resize",this.calculateListHeaderPosition),this.$on("beforeDestroy",(()=>{s.eventBus.unsubscribe("app.user-management.list.load",e)}))},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("runtime/spaces",["UPDATE_SPACE_FIELD"]),calculateListHeaderPosition(){this.listHeaderPosition=this.$refs?.template?.$refs?.appBar?.getBoundingClientRect()?.height},toggleSelectAllUsers(){if(this.allUsersSelected)return this.selectedUsers=[];this.selectedUsers=[...this.users]},toggleSelectUser(e){if(!this.selectedUsers.find((t=>t.id===e.id)))return this.selectedUsers.push(e);this.selectedUsers=this.selectedUsers.filter((t=>t.id!==e.id))},unselectAllUsers(){this.selectedUsers=[]},toggleCreateUserModal(){this.createUserModalOpen=!this.createUserModalOpen},toggleDeleteUserModal(){this.deleteUserModalOpen=!this.deleteUserModalOpen},selectPanel(e){this.sideBarActivePanel=e||"DetailsPanel"},toggleSideBar(){this.sideBarOpen=!this.sideBarOpen},closeSideBar(){this.sideBarOpen=!1},async showPanel({user:e,panel:t}){await this.loadAdditionalUserDataTask.perform(this,e),this.selectedUsers=[e],this.sideBarActivePanel=t,this.sideBarOpen=!0},async deleteUsers(e){const t=e.map((e=>this.graphClient.users.deleteUser(e.id)));try{await Promise.all(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('User "%{user}" was deleted successfully',"%{userCount} users were deleted successfully",this.selectedUsers.length),{userCount:this.selectedUsers.length,user:this.selectedUsers[0].onPremisesSamAccountName},!0)}),this.users=this.users.filter((t=>!e.find((e=>t.id===e.id)))),this.selectedUsers=[],this.toggleDeleteUserModal()}catch(t){console.error(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Failed to delete user "%{user}"',"Failed to delete %{userCount} users",this.selectedUsers.length),{userCount:e.length,user:e.onPremisesSamAccountName},!0),status:"danger"})}},async createUser(e){try{const t=await this.graphClient.users.createUser(e);this.toggleCreateUserModal(),this.showMessage({title:this.$gettext("User was created successfully")}),this.users.push({...t?.data,memberOf:[],role:this.roles.find((e=>"user"===e.name))})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create user"),status:"danger"})}},async editUser(t){try{const r=this.users.find((e=>e.id===t.id)),a={...r&&r,passwordProfile:{password:""}},i=t=>e.omit(t,["drive","role"]);if(e.isEqual(i(a),i(t))||await this.graphClient.users.editUser(t.id,i(t)),!e.isEqual(a.drive,t.drive)){const e=await this.graphClient.drives.updateDrive(t.drive.id,{quota:{total:t.drive.quota.total}},{});t.id===this.currentUser.uuid&&this.UPDATE_SPACE_FIELD({id:t.drive.id,field:"spaceQuota",value:e.data.quota})}e.isEqual(a.role,t.role)||await e.axios.post("/api/v0/settings/assignments-add",{account_uuid:t.id,role_id:t.role.id},{headers:{authorization:`Bearer ${this.accessToken}`,"X-Request-ID":e.v4()}}),this.$set(this.users,this.users.findIndex((e=>e.id===t.id)),t),this.selectedUsers=[t],s.eventBus.publish("sidebar.entity.saved")}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to edit user"),status:"danger"})}},async editUserGroupAssignments(e){try{const t=this.users.find((t=>t.id===e.id)),r=e.memberOf.filter((e=>!t.memberOf.includes(e))),a=t.memberOf.filter((t=>!e.memberOf.includes(t)));for(const e of r)await this.graphClient.groups.addMember(e.id,t.id,this.configuration.server);for(const e of a)await this.graphClient.groups.deleteMember(e.id,t.id);this.$set(this.users,this.users.findIndex((t=>t.id===e.id)),e),this.selectedUsers=[e],s.eventBus.publish("sidebar.entity.saved")}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to edit group assignments"),status:"danger"})}}}});var E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-template",{ref:"template",attrs:{loading:e.loadResourcesTask.isRunning||!e.loadResourcesTask.last,breadcrumbs:e.breadcrumbs,"side-bar-active-panel":e.sideBarActivePanel,"side-bar-available-panels":e.sideBarAvailablePanels,"side-bar-open":e.sideBarOpen},on:{selectPanel:e.selectPanel,closeSideBar:e.closeSideBar,toggleSideBar:e.toggleSideBar},scopedSlots:e._u([{key:"topbarActions",fn:function(){return[s("div",{staticClass:"user-management-app-bar-actions oc-mt-xs"},[e.selectedUsers.length?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("span",{domProps:{textContent:e._s(e.selectedUsersText)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Clear selection"),expression:"$gettext('Clear selection')"}],staticClass:"oc-ml-m",attrs:{id:"files-clear-selection","aria-label":e.$gettext("Clear selection"),appearance:"outline"},on:{click:e.unselectAllUsers}},[s("oc-icon",{attrs:{name:"close"}})],1),e._v(" "),s("oc-button",{staticClass:"oc-ml-m",attrs:{appearance:"outline"},on:{click:e.toggleDeleteUserModal}},[s("oc-icon",{attrs:{name:"delete-bin"}}),e._v(" "),s("translate",[e._v("Delete")])],1)],1):s("div",[s("oc-button",{attrs:{variation:"primary",appearance:"filled"},on:{click:e.toggleCreateUserModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New user")])],1)],1)])]},proxy:!0},{key:"mainContent",fn:function(){return[e.users.length?s("div",[s("UsersList",{class:{"users-table-squashed":e.sideBarOpen},attrs:{users:e.users,"selected-users":e.selectedUsers,"header-position":e.listHeaderPosition},on:{toggleSelectUser:e.toggleSelectUser,toggleSelectAllUsers:e.toggleSelectAllUsers,showPanel:e.showPanel}})],1):s("no-content-message",{staticClass:"files-empty",attrs:{id:"user-management-users-empty",icon:"user"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No users in here")])]},proxy:!0}],null,!1,1415189524)})]},proxy:!0}])}),e._v(" "),e.createUserModalOpen?s("create-user-modal",{attrs:{"existing-users":e.users},on:{cancel:e.toggleCreateUserModal,confirm:e.createUser}}):e._e(),e._v(" "),e.deleteUserModalOpen?s("delete-user-modal",{attrs:{users:e.selectedUsers},on:{cancel:e.toggleDeleteUserModal,confirm:e.deleteUsers}}):e._e()],1)};E._withStripped=!0;const z=e.normalizeComponent({render:E,staticRenderFns:[]},undefined,O,undefined,false,undefined,!1,void 0,void 0,void 0);const F={name:"GroupsList",props:{groups:{type:Array,required:!0},selectedGroups:{type:Array,required:!0},headerPosition:{type:Number,required:!0}},data:function(){return{sortBy:"displayName",sortDir:"asc",markInstance:null,filterTerm:""}},computed:{fields:function(){return[{name:"select",title:"",type:"slot",width:"shrink",headerType:"slot"},{name:"avatar",title:"",type:"slot",width:"shrink"},{name:"displayName",title:this.$gettext("Group name"),sortable:!0},{name:"members",title:this.$gettext("Members"),type:"slot",sortable:!0},{name:"actions",title:this.$gettext("Actions"),sortable:!1,type:"slot",alignH:"right"}]},allGroupsSelected:function(){return this.groups.length===this.selectedGroups.length},footerTextTotal:function(){var e=this.$gettext("%{groupCount} groups in total");return this.$gettextInterpolate(e,{groupCount:this.groups.length})},footerTextFilter:function(){var e=this.$gettext("%{groupCount} matching groups");return this.$gettextInterpolate(e,{groupCount:this.data.length})},data:function(){var e=this.orderBy(this.groups,this.sortBy,"desc"===this.sortDir);return this.filter(e,this.filterTerm)},highlighted:function(){return this.selectedGroups.map((function(e){return e.id}))}},watch:{filterTerm:function(){this.markInstance&&(this.markInstance.unmark(),this.markInstance.mark(this.filterTerm,{element:"span",className:"highlight-mark",exclude:["th *","tfoot *"]}))}},mounted:function(){var t=this;this.$nextTick((function(){t.markInstance=new e.mark(t.$refs.table.$el)}))},methods:{filter:function(t,s){return(s||"").trim()?new e.Fuse(t,{includeScore:!0,useExtendedSearch:!0,threshold:.3,keys:["displayName"]}).search(s).map((function(e){return e.item})):t},orderBy:function(e,s,r){return t._toConsumableArray(e).sort((function(e,t){return e=e[s]||"",t=t[s]||"",r?t.localeCompare(e):e.localeCompare(t)}))},handleSort:function(e){this.sortBy=e.sortBy,this.sortDir=e.sortDir},getSelectGroupLabel:function(e){var t=this.$gettext("Select %{ group }");return this.$gettextInterpolate(t,{group:e.displayName},!0)}}};var T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-text-input",{staticClass:"oc-ml-m oc-my-s",attrs:{id:"groups-filter",label:e.$gettext("Filter groups"),autocomplete:"off"},model:{value:e.filterTerm,callback:function(t){e.filterTerm=t},expression:"filterTerm"}}),e._v(" "),s("oc-table",{ref:"table",attrs:{"sort-by":e.sortBy,"sort-dir":e.sortDir,fields:e.fields,data:e.data,highlighted:e.highlighted,sticky:!0,"header-position":e.headerPosition},on:{sort:e.handleSort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",label:e.$gettext("Select all groups"),value:e.allGroupsSelected,"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectAllGroups")}}})]},proxy:!0},{key:"select",fn:function(t){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",value:e.selectedGroups,option:t.item,label:e.getSelectGroupLabel(t.item),"hide-label":""},on:{input:function(s){return e.$emit("toggleSelectGroup",t.item)}}})]}},{key:"avatar",fn:function(e){return[s("avatar-image",{attrs:{width:32,userid:e.item.id,"user-name":e.item.displayName}})]}},{key:"members",fn:function(t){return[e._v("\n      "+e._s(t.item.members.length)+"\n    ")]}},{key:"actions",fn:function(t){var r=t.item;return[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Details"),expression:"$gettext('Details')"}],staticClass:"oc-mr-xs quick-action-button oc-p-xs",attrs:{appearance:"raw"},on:{click:function(t){return e.$emit("showPanel",{group:r,panel:"DetailsPanel"})}}},[s("oc-icon",{attrs:{name:"information","fill-type":"line"}})],1)]}},{key:"footer",fn:function(){return[s("div",{staticClass:"oc-text-nowrap oc-text-center oc-width-1-1 oc-my-s"},[s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerTextTotal))]),e._v(" "),e.filterTerm?s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerTextFilter))]):e._e()])]},proxy:!0}])})],1)};T._withStripped=!0;const I=e.normalizeComponent({render:T,staticRenderFns:[]},undefined,F,undefined,false,undefined,!1,void 0,void 0,void 0);const q={name:"CreateGroupModal",props:{existingGroups:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{formData:{displayName:{errorMessage:"",valid:!1}},group:{displayName:""}}},computed:{buttonConfirmDisabled:function(){var e=this;return Object.keys(this.formData).map((function(t){return!!e.formData[t].valid})).includes(!1)}},methods:{validateDisplayName:function(){var e=this;return this.formData.displayName.valid=!1,""===this.group.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Group name cannot be empty"),!1):this.existingGroups.find((function(t){return t.displayName===e.group.displayName}))?(this.formData.displayName.errorMessage=this.$gettextInterpolate(this.$gettext('Group "%{groupName}" already exists'),{groupName:this.group.displayName}),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)}}};var L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-modal",{attrs:{title:e.$gettext("Create group"),"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Create"),"button-confirm-disabled":e.buttonConfirmDisabled,"focus-trap-initial":"#create-group-input-display-name"},on:{cancel:function(t){return e.$emit("cancel")},confirm:function(t){return e.$emit("confirm",e.group)}},scopedSlots:e._u([{key:"content",fn:function(){return[s("form",{attrs:{autocomplete:"off"}},[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"create-group-input-display-name",label:e.$gettext("Group name")+"*","error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.group.displayName,callback:function(t){e.$set(e.group,"displayName",t)},expression:"group.displayName"}})],1)]},proxy:!0}])})};L._withStripped=!0;const R=e.normalizeComponent({render:L,staticRenderFns:[]},undefined,q,undefined,false,undefined,!1,void 0,void 0,void 0);const j={name:"DeleteGroupModal",props:{groups:{type:Array,required:!0}},computed:{title:function(){return this.$gettextInterpolate(this.$ngettext("Delete group %{group}?","Delete %{groupCount} selected groups?",this.groups.length),{group:this.groups[0].displayName,groupCount:this.groups.length})},message:function(){return this.$ngettext("Are you sure you want to delete this group?","Are you sure you want to delete all selected groups?",this.groups.length)}}};var H=function(){var e=this,t=e.$createElement;return(e._self._c||t)("oc-modal",{attrs:{icon:"alarm-warning",title:e.title,message:e.message,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Delete"),variation:"danger"},on:{confirm:function(t){return e.$emit("confirm",e.groups)},cancel:function(t){return e.$emit("cancel")}}})};H._withStripped=!0;const Q=e.normalizeComponent({render:H,staticRenderFns:[]},undefined,j,undefined,false,undefined,!1,void 0,void 0,void 0);const V={name:"DetailsPanel",props:{groups:{type:Array,required:!0}},computed:{group:function(){return 1===this.groups.length?this.groups[0]:null},noGroups:function(){return!this.groups.length},multipleGroups:function(){return this.groups.length>1},multipleGroupsSelectedText:function(){return this.$gettextInterpolate("%{count} groups selected",{count:this.groups.length})}}};var X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mt-xl"},[e.noGroups?s("div",{staticClass:"oc-flex group-info"},[s("oc-icon",{attrs:{name:"group-2",size:"xxlarge"}}),e._v(" "),s("p",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("Select a group to view details")])],1):e._e(),e._v(" "),e.multipleGroups?s("div",{staticClass:"oc-flex group-info"},[s("oc-icon",{attrs:{name:"group-2",size:"xxlarge"}}),e._v(" "),s("p",[e._v(e._s(e.multipleGroupsSelectedText))])],1):e._e(),e._v(" "),e.group?s("div",[s("div",{staticClass:"oc-flex group-info oc-mb-l"},[s("avatar-image",{staticClass:"oc-mb-m",attrs:{width:80,userid:e.group.id,"user-name":e.group.displayName}}),e._v(" "),s("span",{staticClass:"oc-text-muted group-info-display-name",domProps:{textContent:e._s(e.group.displayName)}})],1),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.$gettext("Overview of the information about the selected group")}},[s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Group name"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.group.displayName)}})])])]):e._e()])};X._withStripped=!0;const K=e.normalizeComponent({render:X,staticRenderFns:[]},undefined,V,undefined,false,undefined,!1,void 0,void 0,void 0);const Z={name:"EditPanel",components:{CompareSaveDialog:U},props:{groups:{type:Array,required:!0}},data:function(){return{editGroup:{},formData:{displayName:{errorMessage:"",valid:!0}}}},computed:{group:function(){return 1===this.groups.length?this.groups[0]:null},invalidFormData:function(){return Object.values(this.formData).map((function(e){return!!e.valid})).includes(!1)}},watch:{group:{handler:function(){this.editGroup=t._objectSpread2({},this.group)},deep:!0,immediate:!0}},methods:{validateDisplayName:function(){return this.formData.displayName.valid=!1,""===this.editGroup.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Display name cannot be empty"),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)},revertChanges:function(){this.editGroup=t._objectSpread2({},this.group),Object.values(this.formData).forEach((function(e){e.valid=!0,e.errorMessage=""}))}}};var J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-mt-xl",attrs:{id:"group-edit-panel"}},[s("div",{staticClass:"oc-flex group-info oc-mb-l"},[s("avatar-image",{staticClass:"oc-mb-m",attrs:{width:80,userid:e.group.id,"user-name":e.group.displayName}}),e._v(" "),s("span",{staticClass:"oc-text-muted group-info-display-name",domProps:{textContent:e._s(e.group.displayName)}})],1),e._v(" "),s("form",{staticClass:"oc-background-highlight oc-p-m",attrs:{id:"group-edit-form",autocomplete:"off"}},[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{label:e.$gettext("Group name"),"error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.editGroup.displayName,callback:function(t){e.$set(e.editGroup,"displayName",t)},expression:"editGroup.displayName"}}),e._v(" "),s("compare-save-dialog",{staticClass:"edit-compare-save-dialog oc-mb-l",attrs:{"original-object":e.group,"compare-object":e.editGroup,"confirm-button-disabled":e.invalidFormData},on:{revert:e.revertChanges,confirm:function(t){return e.$emit("confirm",e.editGroup)}}})],1)])};J._withStripped=!0;const W=e.normalizeComponent({render:J,staticRenderFns:[]},undefined,Z,undefined,false,undefined,!1,void 0,void 0,void 0);const Y=e.defineComponent({components:{AppTemplate:M,GroupsList:I,NoContentMessage:r.__vue_component__$1,CreateGroupModal:R,DeleteGroupModal:Q},setup(){const t=e.ref([]),{graphClient:s}=i.useGraphClient(),r=e.C((function*(r,a){const i=yield e.unref(s).groups.listGroups("displayName");t.value=i.data.value||[],t.value.forEach((e=>{e.members=e.members||[]}))}));return{groups:t,loadResourcesTask:r,graphClient:s}},data:function(){return{listHeaderPosition:0,selectedGroups:[],createGroupModalOpen:!1,deleteGroupModalOpen:!1,sideBarOpen:!1,sideBarActivePanel:"DetailsPanel"}},computed:{selectedGroupsText(){const e=this.$gettext("%{ groupCount } selected");return this.$gettextInterpolate(e,{groupCount:this.selectedGroups.length})},breadcrumbs(){return[{text:this.$gettext("User management"),to:{path:"/user-management"}},{text:this.$gettext("Groups"),onClick:()=>s.eventBus.publish("app.user-management.list.load")}]},allGroupsSelected(){return this.groups.length===this.selectedGroups.length},sideBarAvailablePanels(){return[{app:"DetailsPanel",icon:"group-2",title:this.$gettext("Group details"),component:K,default:!0,enabled:!0,componentAttrs:{groups:this.selectedGroups}},{app:"EditPanel",icon:"pencil",title:this.$gettext("Edit group"),component:W,default:!1,enabled:!1}]},toggleSidebarButtonLabel(){return this.$gettext(this.sideBarOpen?"Close sidebar to hide details":"Open sidebar to view details")},toggleSidebarButtonIconFillType(){return this.sideBarOpen?"fill":"line"}},watch:{selectedGroups(){(!this.selectedGroups.length||this.selectedGroups.length>1)&&(this.sideBarActivePanel="DetailsPanel")}},async mounted(){await this.loadResourcesTask.perform(this);const e=s.eventBus.subscribe("app.user-management.list.load",(()=>{this.loadResourcesTask.perform(this)}));this.calculateListHeaderPosition(),window.addEventListener("resize",this.calculateListHeaderPosition),this.$on("beforeDestroy",(()=>{s.eventBus.unsubscribe("app.user-management.list.load",e)}))},methods:{...e.mapActions(["showMessage"]),calculateListHeaderPosition(){this.listHeaderPosition=this.$refs?.template?.$refs?.appBar?.getBoundingClientRect()?.height},toggleSelectAllGroups(){if(this.allGroupsSelected)return this.selectedGroups=[];this.selectedGroups=[...this.groups]},toggleSelectGroup(e){if(!this.selectedGroups.find((t=>t.id===e.id)))return this.selectedGroups.push(e);this.selectedGroups=this.selectedGroups.filter((t=>t.id!==e.id))},unselectAllGroups(){this.selectedGroups=[]},toggleCreateGroupModal(){this.createGroupModalOpen=!this.createGroupModalOpen},toggleDeleteGroupModal(){this.deleteGroupModalOpen=!this.deleteGroupModalOpen},selectPanel(e){this.sideBarActivePanel=e||"DetailsPanel"},toggleSideBar(){this.sideBarOpen=!this.sideBarOpen},closeSideBar(){this.sideBarOpen=!1},showPanel({group:e,panel:t}){this.selectedGroups=[e],this.sideBarActivePanel=t,this.sideBarOpen=!0},async deleteGroups(e){const t=e.map((e=>this.graphClient.groups.deleteGroup(e.id)));try{await Promise.all(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Group "%{group}" was deleted successfully',"%{groupCount} groups were deleted successfully",this.selectedGroups.length),{groupCount:this.selectedGroups.length,group:this.selectedGroups[0].displayName},!0)}),this.groups=this.groups.filter((t=>!e.find((e=>t.id===e.id)))),this.selectedGroups=[],this.toggleDeleteGroupModal()}catch(e){console.error(e),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Failed to delete group "%{group}"',"Failed to delete %{groupCount} groups",this.selectedGroups.length),{groupCount:this.selectedGroups.length,group:this.selectedGroups[0].displayName},!0),status:"danger"})}},async createGroup(e){try{const t=await this.graphClient.groups.createGroup(e);this.toggleCreateGroupModal(),this.showMessage({title:this.$gettext("Group was created successfully")}),this.groups.push({...t?.data,members:[]})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create group"),status:"danger"})}},async editGroup(e){try{await this.graphClient.groups.editGroup(e.id,e);const t=this.groups.find((t=>t.id===e.id));Object.assign(t,e),this.showMessage({title:this.$gettext("Group was edited successfully")})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to edit group"),status:"danger"})}}}});var ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-template",{ref:"template",attrs:{loading:e.loadResourcesTask.isRunning||!e.loadResourcesTask.last,breadcrumbs:e.breadcrumbs,"side-bar-active-panel":e.sideBarActivePanel,"side-bar-available-panels":e.sideBarAvailablePanels,"side-bar-open":e.sideBarOpen},on:{selectPanel:e.selectPanel,closeSideBar:e.closeSideBar,toggleSideBar:e.toggleSideBar},scopedSlots:e._u([{key:"topbarActions",fn:function(){return[s("div",{staticClass:"user-management-app-bar-actions oc-mt-xs"},[e.selectedGroups.length?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("span",{domProps:{textContent:e._s(e.selectedGroupsText)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Clear selection"),expression:"$gettext('Clear selection')"}],staticClass:"oc-ml-m",attrs:{id:"files-clear-selection","aria-label":e.$gettext("Clear selection"),appearance:"outline"},on:{click:e.unselectAllGroups}},[s("oc-icon",{attrs:{name:"close"}})],1),e._v(" "),s("oc-button",{staticClass:"oc-ml-m",attrs:{appearance:"outline"},on:{click:e.toggleDeleteGroupModal}},[s("oc-icon",{attrs:{name:"delete-bin"}}),e._v(" "),s("translate",[e._v("Delete")])],1)],1):s("div",[s("oc-button",{attrs:{variation:"primary",appearance:"filled"},on:{click:e.toggleCreateGroupModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New group")])],1)],1)])]},proxy:!0},{key:"mainContent",fn:function(){return[e.groups.length?s("div",[s("GroupsList",{attrs:{groups:e.groups,"selected-groups":e.selectedGroups,"header-position":e.listHeaderPosition},on:{toggleSelectGroup:e.toggleSelectGroup,toggleSelectAllGroups:e.toggleSelectAllGroups,showPanel:e.showPanel}})],1):s("no-content-message",{staticClass:"files-empty",attrs:{id:"user-management-groups-empty",icon:"user"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No groups in here")])]},proxy:!0}],null,!1,1866182106)})]},proxy:!0}])}),e._v(" "),e.createGroupModalOpen?s("create-group-modal",{attrs:{"existing-groups":e.groups},on:{cancel:e.toggleCreateGroupModal,confirm:e.createGroup}}):e._e(),e._v(" "),e.deleteGroupModalOpen?s("delete-group-modal",{attrs:{groups:e.selectedGroups},on:{cancel:e.toggleDeleteGroupModal,confirm:e.deleteGroups}}):e._e()],1)};ee._withStripped=!0;var te={name:"User management",id:"user-management",icon:"user-settings",isFileEditor:!1};return{appInfo:te,routes:[{path:"/",redirect:function(){return{name:"user-management-users"}}},{path:"/users",name:"user-management-users",component:z,meta:{authContext:"user",title:"Users"}},{path:"/groups",name:"user-management-groups",component:e.normalizeComponent({render:ee,staticRenderFns:[]},undefined,Y,undefined,false,undefined,!1,void 0,void 0,void 0),meta:{authContext:"user",title:"Groups"}}],translations:n,navItems:[{name:"Users",icon:"user",route:{path:"/".concat(te.id,"/users?")},enabled:function(){return window.Vue.$permissionManager.hasUserManagement()}},{name:"Groups",icon:"group-2",route:{path:"/".concat(te.id,"/groups?")},enabled:function(){return window.Vue.$permissionManager.hasUserManagement()}}]}}));
