define(["./chunks/_rollupPluginBabelHelpers-d0b0ebba","./chunks/vendor-22992e2c","./chunks/List-7b7e3ab3","./chunks/visibility-c7f197c2","./chunks/base-fbc1ccef","./chunks/useUserContext-a419a918"],(function(e,t,r,i,s,n){"use strict";const a=t.defineComponent({name:"SearchBar",setup:function(){var e=i.useStore();return{isUserContext:n.useUserContext({store:e})}},data:function(){return{resizeObserver:new ResizeObserver(this.onResize),showCancelButton:!1,term:"",activeProvider:void 0,optionsVisible:!1,markInstance:null,activePreviewIndex:null,debouncedSearch:void 0,providerStore:r.providerStore,loading:!1,searchResults:[]}},computed:{showNoResults:function(){return this.searchResults.every((function(e){return!e.result.values.length}))},availableProviders:function(){return this.providerStore.availableProviders},isSearchBarEnabled:function(){return this.availableProviders.length&&this.isUserContext},displayProviders:function(){var e=this;return this.availableProviders.filter((function(t){return e.getSearchResultForProvider(t).values.length}))},searchLabel:function(){return this.$gettext("Enter search term")}},watch:{term:function(){this.debouncedSearch(this)},searchResults:function(){var e=this;this.activePreviewIndex=null,this.$nextTick((function(){e.$refs.optionsDrop&&(e.markInstance=new t.mark(e.$refs.optionsDrop.$refs.drop),e.markInstance.unmark(),e.markInstance.mark(e.term,{element:"span",className:"highlight-mark",exclude:[".provider-details *"]}))}))},$route:{handler:function(e){var t=this;this.$nextTick((function(){var r;if(t.availableProviders.length){var i=null==e||null===(r=e.query)||void 0===r?void 0:r.term,s=t.$el.getElementsByTagName("input")[0];s&&i&&(t.term=i,s.value=i)}}))},immediate:!0}},created:function(){var e=this;this.debouncedSearch=t.debounce(this.search,500);var r=i.eventBus.subscribe("app.search.options-drop.hide",(function(){e.$refs.optionsDrop.hide()}));this.$on("beforeDestroy",(function(){i.eventBus.unsubscribe("app.search.options-drop.hide",r)}))},mounted:function(){this.isSearchBarEnabled&&this.resizeObserver.observe(this.$refs.searchBar)},beforeDestroy:function(){this.isSearchBarEnabled&&this.resizeObserver.unobserve(this.$refs.searchBar)},methods:{showPreview:function(){var t=this;return e._asyncToGenerator(e._regeneratorRuntime().mark((function r(){return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.term){e.next=2;break}return e.abrupt("return");case 2:return t.$refs.optionsDrop.show(),e.next=5,t.search();case 5:case"end":return e.stop()}}),r)})))()},search:function(){var t=this;return e._asyncToGenerator(e._regeneratorRuntime().mark((function r(){var i,s,n,a;return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.searchResults=[],t.term){r.next=3;break}return r.abrupt("return");case 3:t.loading=!0,i=e._createForOfIteratorHelper(t.availableProviders),r.prev=5,i.s();case 7:if((s=i.n()).done){r.next=19;break}if(a=s.value,null===(n=a.previewSearch)||void 0===n||!n.available){r.next=17;break}return r.t0=t.searchResults,r.t1=a.id,r.next=14,a.previewSearch.search(t.term);case 14:r.t2=r.sent,r.t3={providerId:r.t1,result:r.t2},r.t0.push.call(r.t0,r.t3);case 17:r.next=7;break;case 19:r.next=24;break;case 21:r.prev=21,r.t4=r.catch(5),i.e(r.t4);case 24:return r.prev=24,i.f(),r.finish(24);case 27:t.loading=!1;case 28:case"end":return r.stop()}}),r,null,[[5,21,24,27]])})))()},onClear:function(){this.term="",this.$refs.optionsDrop.hide()},onKeyUpEnter:function(){this.$refs.optionsDrop.hide(),this.term&&null===this.activePreviewIndex&&this.$router.push(r.createLocationCommon("files-common-search",{query:{term:this.term,provider:"files.sdk"}})),null!==this.activePreviewIndex&&this.$refs.optionsDrop.$el.querySelectorAll(".preview")[this.activePreviewIndex].firstChild.click()},onKeyUpUp:function(){var e=this.$refs.optionsDrop.$el.querySelectorAll(".preview").length;e&&(null===this.activePreviewIndex?this.activePreviewIndex=e-1:this.activePreviewIndex=0===this.activePreviewIndex?null:this.activePreviewIndex-1,this.scrollToActivePreviewOption())},onKeyUpDown:function(){var e=this.$refs.optionsDrop.$el.querySelectorAll(".preview").length;e&&(null===this.activePreviewIndex?this.activePreviewIndex=0:this.activePreviewIndex=this.activePreviewIndex===e-1?null:this.activePreviewIndex+1,this.scrollToActivePreviewOption())},scrollToActivePreviewOption:function(){if("function"==typeof this.$refs.optionsDrop.$el.scrollTo){var e=this.$refs.optionsDrop.$el.querySelectorAll(".preview");this.$refs.optionsDrop.$el.scrollTo(0,null===this.activePreviewIndex?0:e[this.activePreviewIndex].getBoundingClientRect().y-e[this.activePreviewIndex].getBoundingClientRect().height)}},updateTerm:function(e){return this.term=e,this.term?this.$refs.optionsDrop.show():this.$refs.optionsDrop.hide()},getSearchResultForProvider:function(e){var t;return null===(t=this.searchResults.find((function(t){return t.providerId===e.id})))||void 0===t?void 0:t.result},getMoreResultsLinkForProvider:function(e){return r.createLocationCommon("files-common-search",{query:{term:this.term,provider:e.id}})},getMoreResultsDetailsTextForProvider:function(e){var t=this.getSearchResultForProvider(e);if(!t||!t.totalResults)return this.$gettext("Show all results");var r=this.$ngettext("Show %{totalResults} result","Show %{totalResults} results",t.totalResults);return this.$gettextInterpolate(r,{totalResults:t.totalResults})},isPreviewElementActive:function(e){var t,r;return(null===(t=this.$refs.optionsDrop.$el.querySelectorAll(".preview")[this.activePreviewIndex])||void 0===t||null===(r=t.dataset)||void 0===r?void 0:r.searchId)===e},showSearchBar:function(){document.getElementById("files-global-search-bar").style.visibility="visible",document.getElementsByClassName("oc-search-input")[0].focus(),this.showCancelButton=!0},cancelSearch:function(){document.getElementById("files-global-search-bar").style.visibility="hidden",this.showCancelButton=!1},onResize:function(){var e=document.getElementById("files-global-search-bar"),t=!!document.querySelector('.tippy-box[data-state="visible"]');window.innerWidth>639?(e.style.visibility="visible",this.showCancelButton=!1):t?(e.style.visibility="visible",this.showCancelButton=!0):(e.style.visibility="hidden",this.showCancelButton=!1)}}});var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isSearchBarEnabled?r("div",{ref:"searchBar",staticClass:"oc-flex",attrs:{id:"files-global-search","data-custom-key-bindings":"true"}},[r("oc-search-bar",{ref:"search",attrs:{id:"files-global-search-bar",label:e.searchLabel,"type-ahead":!0,placeholder:e.searchLabel,"button-hidden":!0,"show-cancel-button":e.showCancelButton,"cancel-button-variation":"inverse","cancel-handler":e.cancelSearch},on:{input:e.updateTerm,clear:e.onClear},nativeOn:{click:function(t){return e.showPreview.apply(null,arguments)},keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$refs.optionsDrop.hide()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.onKeyUpUp.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.onKeyUpDown.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onKeyUpEnter.apply(null,arguments)}]}}),e._v(" "),r("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Display search bar"),expression:"$gettext('Display search bar')"}],staticClass:"mobile-search-btn oc-mr-s",attrs:{"aria-label":e.$gettext("Click to display and focus the search bar"),appearance:"raw",variation:"inverse"},on:{click:e.showSearchBar}},[r("oc-icon",{attrs:{name:"search","fill-type":"line"}})],1),e._v(" "),r("oc-drop",{ref:"optionsDrop",attrs:{id:"files-global-search-options",mode:"manual",target:"#files-global-search-bar"}},[r("oc-list",{staticClass:"oc-list-divider"},[e.loading?r("li",{staticClass:"loading spinner oc-flex oc-flex-center oc-flex-middle oc-text-muted"},[r("oc-spinner",{attrs:{size:"small","aria-hidden":!0,"aria-label":""}}),e._v(" "),r("span",{staticClass:"oc-ml-s"},[e._v(e._s(e.$gettext("Searching ...")))])],1):e.showNoResults?r("li",{staticClass:"oc-flex oc-flex-center",attrs:{id:"no-results"}},[e._v("\n        "+e._s(e.$gettext("No results"))+"\n      ")]):e._l(e.displayProviders,(function(t){return r("li",{key:t.id,staticClass:"provider"},[r("oc-list",[r("li",{staticClass:"oc-text-truncate oc-flex oc-flex-between oc-text-muted provider-details"},[r("span",{staticClass:"display-name"},[e._v(e._s(t.displayName))]),e._v(" "),r("span",[r("router-link",{staticClass:"more-results",attrs:{to:e.getMoreResultsLinkForProvider(t)},nativeOn:{click:function(t){return e.$refs.optionsDrop.hide()}}},[r("span",[e._v(e._s(e.getMoreResultsDetailsTextForProvider(t)))])])],1)]),e._v(" "),e._l(e.getSearchResultForProvider(t).values,(function(i){return r("li",{key:i.id,staticClass:"preview oc-flex oc-flex-middle",class:{active:e.isPreviewElementActive(i.id)},attrs:{"data-search-id":i.id}},[r(t.previewSearch.component,{tag:"component",staticClass:"preview-component",attrs:{provider:t,"search-result":i},nativeOn:{click:function(t){return e.$refs.optionsDrop.hide()}}})],1)}))],2)],1)}))],2)],1)],1):r("div")};o._withStripped=!0;const l=t.normalizeComponent({render:o,staticRenderFns:[]},undefined,a,undefined,false,undefined,!1,void 0,void 0,void 0);const c={name:"Search"};var u=function(){var e=this.$createElement,t=this._self._c||e;return t("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"search"}},[t("router-view",{attrs:{id:"search-view"}})],1)};u._withStripped=!0;const h=t.normalizeComponent({render:u,staticRenderFns:[]},undefined,c,undefined,false,undefined,!1,void 0,void 0,void 0);var d={cs:{Search:"Hledat"},de:{"Click to display and focus the search bar":"Klicken um die Suchleiste anzuzeigen und zu fokussieren","Display search bar":"Suchleiste anzeigen","Enter search term":"Suchbegriff eingeben","No results":"Keine Ergebnisse",Search:"Suchen","Searching ...":"Suche...","Show %{totalResults} result":["Zeige %{totalResults} Ergebnisse","Zeige %{totalResults} Ergebnisse"],"Show all results":"Zeige alle Ergebnisse"},es:{"Enter search term":"Introduzca termino de búsqueda",Search:"Buscar"},fr:{"Enter search term":"Saisissez le terme à rechercher",Search:"Recherche"},gl:{Search:"Buscar"},it:{}};return i.eventBus.subscribe("app.search.register.provider",(e=>{r.providerStore.addProvider(e)})),{appInfo:{name:"Search",id:"search",icon:"folder"},routes:[{name:"search",path:"/",component:h,children:[{name:"provider-list",path:"list/:page?",component:r.__vue_component__,meta:{authContext:"user",contextQueryItems:["term","provider"]}}]}],translations:d,mounted({portal:e}){e.open("runtime","header",1,[l])}}}));
