define(["exports","./vendor-22992e2c","./base-fbc1ccef"],(function(e,i,n){"use strict";function r(e,i=""){return"/"+`public-files/${e}/${i}`.split("/").filter(Boolean).join("/")}const a={complex:["tar.bz2","tar.gz",".tar.xz"]};function s(e,i){return n.urlJoin("spaces",e,i,{leadingSlash:!0})}function t(e,i=""){return n.urlJoin("spaces","trash-bin",e,i,{leadingSlash:!0})}const o=e=>e.replace(/[^A-Za-z0-9\-_]/g,""),l=(e,i)=>e&&"string"==typeof e&&e.indexOf("!")>=0?e.split("!")[i]:"",c=e=>l(e,0),d=e=>l(e,1),p=e=>{const i=e.name;if("dir"===e.type||"folder"===e.type||e.isFolder)return"";const n=i.split(".");if(n.length>2)for(let e=0;e<n.length;e++){const i=n.slice(e,n.length).join(".");if(a.complex.includes(i))return i}return n.length<2?"":n[n.length-1]};const u="a0ca6a90-a365-4782-871e-d44447bbc668";function f(e){let i,r,a=!1;const l=Object.fromEntries(n.SpacePeopleShareRoles.list().map((e=>[e.name,[]])));if(e.special&&(i=e.special.find((e=>"image"===e.specialFolder.name)),r=e.special.find((e=>"readme"===e.specialFolder.name)),i&&(i.webDavUrl=decodeURI(i.webDavUrl)),r&&(r.webDavUrl=decodeURI(r.webDavUrl))),e.root?.permissions){for(const i of e.root.permissions)for(const e of n.SpacePeopleShareRoles.list())i.roles.includes(e.name)&&l[e.name].push(...i.grantedTo.map((e=>e.user.id)));e.root?.deleted&&(a="trashed"===e.root.deleted?.state)}const c=n.urlJoin(e.webDavPath||s(e.id),{leadingSlash:!0}),p=n.urlJoin(e.serverUrl,"remote.php/dav",c),u=n.urlJoin(e.webDavTrashPath||t(e.id),{leadingSlash:!0}),f=n.urlJoin(e.serverUrl,"remote.php/dav",u),h={id:e.id,fileId:e.id,storageId:e.id,mimeType:"",name:e.name,description:e.description,extension:"",path:"/",webDavPath:c,webDavTrashPath:u,driveAlias:e.driveAlias,driveType:e.driveType,type:"space",isFolder:!0,mdate:e.lastModifiedDateTime,size:"",indicators:[],permissions:"",starred:!1,etag:"",shareId:e.shareId,sharePermissions:"",shareTypes:[],privateLink:"",downloadURL:"",ownerDisplayName:"",ownerId:e.owner?.user?.id,disabled:a,root:e.root,spaceQuota:e.quota,spaceRoles:l,spaceImageData:i,spaceReadmeData:r,canUpload:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&i.includes(e.uuid)},canDownload:function(){return!0},canBeDeleted:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return this.disabled&&e&&i.includes(e.uuid)},canRename:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&i.includes(e.uuid)},canEditDescription:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&i.includes(e.uuid)},canRestore:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return this.disabled&&e&&i.includes(e.uuid)},canDisable:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return!this.disabled&&e&&i.includes(e.uuid)},canShare:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&i.includes(e.uuid)},canEditImage:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&i.includes(e.uuid)},canEditReadme:function({user:e}={}){const i=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&i.includes(e.uuid)},canCreate:function(){return!0},isMounted:function(){return!0},isReceivedShare:function(){return!1},canDeny:()=>!1,getDomSelector:()=>o(e.id),getDriveAliasAndItem({path:e}){return n.urlJoin(this.driveAlias,e,{leadingSlash:!1})},getWebDavUrl:({path:e})=>n.urlJoin(p,e),getWebDavTrashUrl:({path:e})=>n.urlJoin(f,e),isViewer(e){return this.spaceRoles[n.spaceRoleViewer.name].includes(e)},isEditor(e){return this.spaceRoles[n.spaceRoleEditor.name].includes(e)},isManager(e){return this.spaceRoles[n.spaceRoleManager.name].includes(e)}};return Object.defineProperty(h,"nodeId",{get(){return d(this.id)}}),h}e.SHARE_JAIL_ID=u,e.buildPublicSpaceResource=function(e){const i=e.publicLinkPassword,a=e.fileInfo?.[n.DavProperty.PublicLinkItemType],s=e.fileInfo?.[n.DavProperty.PublicLinkPermission],t=e.fileInfo?.[n.DavProperty.PublicLinkExpiration],o=e.fileInfo?.[n.DavProperty.PublicLinkShareDate],l=e.fileInfo?.[n.DavProperty.PublicLinkShareOwner];return Object.assign(f({...e,driveType:"public",driveAlias:`public/${e.id}`,webDavPath:r(e.id)}),{...i&&{publicLinkPassword:i},...a&&{publicLinkItemType:a},...s&&{publicLinkPermission:parseInt(s)},...t&&{publicLinkExpiration:t},...o&&{publicLinkShareDate:o},...l&&{publicLinkShareOwner:l}})},e.buildResource=function(e){const r=e.fileInfo[n.DavProperty.Name]||i.basename(e.name),a="dir"===e.type||"folder"===e.type,s=p({...e,name:r});let t;t=e.name.startsWith("/files")||e.name.startsWith("/space")?e.name.split("/").slice(3).join("/"):e.name,t.startsWith("/")||(t=`/${t}`);const l=e.fileInfo[n.DavProperty.FileId],u={id:l,fileId:l,storageId:c(l),parentFolderId:e.fileInfo[n.DavProperty.FileParent],mimeType:e.fileInfo[n.DavProperty.MimeType],name:r,extension:a?"":s,path:t,webDavPath:e.name,type:a?"folder":e.type,isFolder:a,mdate:e.fileInfo[n.DavProperty.LastModifiedDate],size:a?e.fileInfo[n.DavProperty.ContentSize]:e.fileInfo[n.DavProperty.ContentLength],indicators:[],permissions:e.fileInfo[n.DavProperty.Permissions]||"",starred:"0"!==e.fileInfo[n.DavProperty.IsFavorite],etag:e.fileInfo[n.DavProperty.ETag],sharePermissions:e.fileInfo[n.DavProperty.SharePermissions],shareTypes:e.fileInfo[n.DavProperty.ShareTypes]?e.fileInfo[n.DavProperty.ShareTypes].map((e=>parseInt(e))):[],privateLink:e.fileInfo[n.DavProperty.PrivateLink],downloadURL:e.fileInfo[n.DavProperty.DownloadURL],shareId:e.fileInfo[n.DavProperty.ShareId],shareRoot:e.fileInfo[n.DavProperty.ShareRoot],ownerId:e.fileInfo[n.DavProperty.OwnerId],ownerDisplayName:e.fileInfo[n.DavProperty.OwnerDisplayName],canUpload:function(){return this.permissions.indexOf(n.DavPermission.FolderCreateable)>=0},canDownload:function(){return!0},canBeDeleted:function(){return this.permissions.indexOf(n.DavPermission.Deletable)>=0},canRename:function(){return this.permissions.indexOf(n.DavPermission.Renameable)>=0},canShare:function(){return this.permissions.indexOf(n.DavPermission.Shareable)>=0},canCreate:function(){return this.permissions.indexOf(n.DavPermission.FolderCreateable)>=0},isMounted:function(){return this.permissions.indexOf(n.DavPermission.Mounted)>=0},isReceivedShare:function(){return this.permissions.indexOf(n.DavPermission.Shared)>=0},canDeny:function(){return this.permissions.indexOf(n.DavPermission.Deny)>=0},getDomSelector:()=>o(l)};return Object.defineProperty(u,"nodeId",{get(){return d(this.id)}}),u},e.buildShareSpaceResource=function({shareId:e,shareName:i,serverUrl:n}){const r=f({id:[u,e].join("!"),driveAlias:`share/${i}`,driveType:"share",name:i,shareId:e,serverUrl:n});return r.rename=e=>{r.driveAlias=`share/${e}`,r.name=e},r},e.buildSpace=f,e.buildWebDavPublicPath=r,e.buildWebDavSpacesPath=s,e.buildWebDavSpacesTrashPath=t,e.extractDomSelector=o,e.extractExtensionFromFile=p,e.extractNameWithoutExtension=e=>{const i=e.extension||"",n=e.name||"";if(!i.length)return n;const r=n.lastIndexOf(`.${i}`);return n.substring(0,r)},e.extractNodeId=d,e.extractStorageId=c,e.isMountPointSpaceResource=e=>"mountpoint"===e.driveType,e.isPersonalSpaceResource=e=>"personal"===e.driveType,e.isProjectSpaceResource=e=>"project"===e.driveType,e.isPublicSpaceResource=e=>"public"===e.driveType,e.isShareSpaceResource=e=>"share"===e.driveType}));
